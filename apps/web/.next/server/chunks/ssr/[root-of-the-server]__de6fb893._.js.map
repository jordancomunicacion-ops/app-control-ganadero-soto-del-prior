{"version":3,"sources":["../../../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../../../apps/web/app/lib/actions.ts","../../../../../../apps/web/app/lib/definitions.ts","../../../../../../apps/web/.next-internal/server/app/register/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","'use server';\r\n\r\nimport { signIn, signOut } from '@/auth';\r\nimport { AuthError } from 'next-auth';\r\nimport { CreateUserSchema, UserFormState } from './definitions';\r\nimport bcrypt from 'bcryptjs';\r\nimport { PrismaClient } from '@prisma/client';\r\nimport { redirect } from 'next/navigation';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nexport async function authenticate(\r\n    prevState: string | undefined,\r\n    formData: FormData,\r\n) {\r\n    try {\r\n        await signIn('credentials', formData);\r\n    } catch (error) {\r\n        if (error instanceof AuthError) {\r\n            switch (error.type) {\r\n                case 'CredentialsSignin':\r\n                    return 'Credenciales inválidas.';\r\n                default:\r\n                    return 'Algo salió mal.';\r\n            }\r\n        }\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport async function signOutAction() {\r\n    await signOut();\r\n}\r\n\r\nexport async function registerUser(prevState: UserFormState | undefined, formData: FormData): Promise<UserFormState> {\r\n    const validatedFields = CreateUserSchema.safeParse({\r\n        name: formData.get('name'),\r\n        email: formData.get('email'),\r\n        password: formData.get('password'),\r\n        role: 'USER', // Default role\r\n    });\r\n\r\n    if (!validatedFields.success) {\r\n        return {\r\n            errors: validatedFields.error.flatten().fieldErrors,\r\n            message: 'Faltan campos obligatorios.',\r\n        };\r\n    }\r\n\r\n    const { name, email, password, role } = validatedFields.data;\r\n    const hashedPassword = await bcrypt.hash(password, 10);\r\n\r\n    try {\r\n        await prisma.user.create({\r\n            data: {\r\n                name,\r\n                email,\r\n                password: hashedPassword,\r\n                role: role as 'USER' | 'ADMIN',\r\n            },\r\n        });\r\n    } catch (error) {\r\n        // @ts-ignore\r\n        if (error.code === 'P2002') {\r\n            return {\r\n                message: 'El email ya está en uso.',\r\n            };\r\n        }\r\n        return {\r\n            message: 'Error de base de datos.',\r\n        };\r\n    }\r\n\r\n    redirect('/login');\r\n}\r\n","import { z } from 'zod';\r\n\r\nexport const UserSchema = z.object({\r\n    id: z.string(),\r\n    name: z.string().min(1, { message: 'El nombre es obligatorio.' }),\r\n    email: z.string().email({ message: 'Email inválido.' }),\r\n    password: z.string().min(6, { message: 'La contraseña debe tener al menos 6 caracteres.' }).optional(),\r\n    role: z.enum(['ADMIN', 'USER']),\r\n});\r\n\r\nexport const CreateUserSchema = UserSchema.omit({ id: true }).extend({\r\n    password: z.string().min(6, { message: 'La contraseña es obligatoria.' }),\r\n});\r\n\r\nexport type UserFormState = {\r\n    errors?: {\r\n        name?: string[];\r\n        email?: string[];\r\n        password?: string[];\r\n        role?: string[];\r\n    };\r\n    message?: string | null;\r\n};\r\n","export {registerUser as '60fc680c355e56bb8d6f55e737383470c2d73f7edd'} from 'ACTIONS_MODULE0'\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,1]}