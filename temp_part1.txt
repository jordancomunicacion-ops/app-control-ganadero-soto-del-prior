<!doctype html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Granjas - Soto del Prior</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="background"></div>
    <main class="shell">
        <!-- AUTH SECTION -->
        <section id="auth" class="auth-shell">
            <div class="auth-card">
                <img src="images/logo-soto.png" alt="Soto del Prior" class="logo" onerror="this.style.display='none'">
                <h1 class="auth-title">Acceso a Granjas</h1>
                <div class="tabs">
                    <button id="loginTab" class="tab active">Iniciar sesi√≥n</button>
                    <button id="registerTab" class="tab">Crear cuenta</button>
                </div>
                <form id="loginForm" class="auth-form">
                    <div class="alert hidden" id="loginAlert">Estas credenciales no coinciden con nuestros registros.
                    </div>
                    <label>Usuario
                        <input type="text" id="loginUser" placeholder="gerencia@sotodelprior.com" required>
                    </label>
                    <label>Contrase√±a
                        <input type="password" id="loginPass" placeholder="******" required>
                    </label>
                    <button type="submit" class="primary full">Acceder</button>
                    <label class="remember">
                        <input type="checkbox" id="rememberCheck">
                        <span>Recordarme (guardar usuario y contrase√±a en este navegador)</span>
                    </label>
                    <a class="link" href="#" onclick="return false;">¬øOlvidaste la contrase√±a?</a>
                </form>
                <form id="registerForm" class="auth-form hidden">
                    <label>Usuario
                        <input type="text" id="regUser" placeholder="nuevo usuario" required>
                    </label>
                    <label>Correo electr√≥nico
                        <input type="email" id="regEmail" placeholder="tu@correo.com" required>
                    </label>
                    <label>Contrase√±a
                        <input type="password" id="regPass" placeholder="crea una clave" required>
                    </label>
                    <button type="submit" class="primary full">Registrarse</button>
                </form>
                <div class="footer-bar">Datos guardados en este navegador</div>
            </div>
        </section>

        <!-- DASHBOARD SECTION -->
        <div id="app" class="dashboard hidden">
            <div class="app-layout">
                <!-- SIDEBAR -->
                <aside class="sidebar">
                    <div class="user-card">
                        <div class="avatar" id="sidebarAvatar">U</div>
                        <div>
                            <p class="profile-name" id="sidebarName">Usuario</p>
                            <p class="profile-role">Administrador</p>
                        </div>
                    </div>
                    <nav class="nav">
                        <a href="#" class="nav-link active" data-target="home">üè† Inicio</a>
                        <a href="#" class="nav-link" data-target="animals">üêÑ Animales</a>
                        <a href="#" class="nav-link" data-target="events">üìÖ Eventos</a>
                        <a href="#" class="nav-link" data-target="fcr">üìä Calculadora FCR</a>
                        <a href="#" class="nav-link" data-target="farms">üåæ Fincas</a>
                        <a href="#" class="nav-link" data-target="reports">üìÑ Reportes</a>
                    </nav>
                    <div class="sidebar-actions">
                        <button class="ghost full" id="profileBtn">Mi perfil</button>
                        <button class="ghost full" id="logoutBtn">Cerrar sesi√≥n</button>
                    </div>
                </aside>

                <!-- MAIN CONTENT -->
                <div class="content">
                    <!-- HOME / DASHBOARD -->
                    <div id="home" class="section">
                        <div class="content-head">
                            <div>
                                <p class="eyebrow">PANEL DE CONTROL</p>
                                <h2>Resumen General</h2>
                                <p class="lede">Vista general de tu operaci√≥n ganadera</p>
                            </div>
                        </div>

                        <div class="kpi-row">
                            <div class="kpi">
                                <p class="kpi-label">Total Fincas</p>
                                <p class="kpi-value" id="stat-fincas">0</p>
                                <p class="kpi-foot">Registradas</p>
                            </div>
                            <div class="kpi">
                                <p class="kpi-label">Total Animales</p>
                                <p class="kpi-value" id="stat-animales">0</p>
                                <p class="kpi-foot">En inventario</p>
                            </div>
                            <div class="kpi">
                                <p class="kpi-label">Eventos del Mes</p>
                                <p class="kpi-value" id="stat-eventos">0</p>
                                <p class="kpi-foot">Registrados</p>
                            </div>
                            <div class="kpi">
                                <p class="kpi-label">FCR Promedio</p>
                                <p class="kpi-value" id="stat-fcr">-</p>
                                <p class="kpi-foot">√çndice de conversi√≥n</p>
                            </div>
                        </div>

                        <div class="panel-grid">
                            <div class="card panel-chart">
                                <div class="card-head">
                                    <h3>Distribuci√≥n de Animales</h3>
                                </div>
                                <div class="bars">
                                    <div class="bar">
                                        <div class="bar-fill" id="bar-vacas" style="height: 60%; background: #22c55e;">
                                        </div>
                                        <span>Vacas</span>
                                    </div>
                                    <div class="bar">
                                        <div class="bar-fill" id="bar-toros" style="height: 30%; background: #3b82f6;">
                                        </div>
                                        <span>Toros</span>
                                    </div>
                                    <div class="bar">
                                        <div class="bar-fill" id="bar-terneros"
                                            style="height: 45%; background: #f59e0b;"></div>
                                        <span>Terneros</span>
                                    </div>
                                    <div class="bar">
                                        <div class="bar-fill" id="bar-otros" style="height: 20%; background: #6b7280;">
                                        </div>
                                        <span>Otros</span>
                                    </div>
                                </div>
                            </div>

                            <div class="card panel-quality">
                                <div class="card-head">
                                    <h3>Alertas Recientes</h3>
                                </div>
                                <ul class="quality-list" id="alertsList">
                                    <li>
                                        <span><span class="dot green"></span> Sistema operativo</span>
                                        <span class="pill">OK</span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="actions-card">
                            <h3>Acciones R√°pidas</h3>
                            <div class="action-list">
                                <button class="action-btn" data-action="add-animal">‚ûï Registrar nuevo animal</button>
                                <button class="action-btn" data-action="add-event">üìÖ Registrar evento</button>
                                <button class="action-btn" data-action="calc-fcr">üìä Calcular FCR</button>
                                <button class="action-btn" id="action-report">üìÑ Generar reporte</button>
                            </div>
                        </div>
                    </div>

                    <!-- ANIMALS SECTION -->
                    <div id="animals" class="section hidden">
                        <div class="content-head">
                            <div>
                                <p class="eyebrow">GESTI√ìN DE ANIMALES</p>
                                <h2>Inventario de Animales</h2>
                                <p class="lede">Registro y seguimiento individual</p>
                            </div>
                            <button class="primary" id="toggleAnimalForm">‚ûï Nuevo Animal</button>
                        </div>

                        <div class="card farm-card hidden" id="animalFormCard">
                            <h3>Registrar Nuevo Animal</h3>
                            <form id="animalForm" class="farm-form">
                                <label>ID / Etiqueta
                                    <input type="text" id="animalId" placeholder="Ej: A-001" required>
                                </label>
                                <label>Nombre (opcional)
                                    <input type="text" id="animalName" placeholder="Ej: Lola">
                                </label>
                                <label>Finca
                                    <select id="animalFarm" required>
                                        <option value="">Selecciona una finca</option>
                                    </select>
                                </label>
                                <label>Raza
                                    <select id="animalBreed" required>
                                        <option value="">Selecciona raza</option>
                                        <option value="Avile√±a-Negra Ib√©rica">Avile√±a-Negra Ib√©rica</option>
                                        <option value="Retinta">Retinta</option>
                                        <option value="Morucha">Morucha</option>
                                        <option value="Lidia">Lidia</option>
                                        <option value="Charolais">Charolais</option>
                                        <option value="Limousin">Limousin</option>
                                        <option value="Angus">Angus</option>
                                        <option value="Otra">Otra</option>
                                    </select>
                                </label>
                                <label>Sexo
                                    <select id="animalSex" required>
                                        <option value="">Selecciona sexo</option>
                                        <option value="Hembra">Hembra</option>
                                        <option value="Macho">Macho</option>
                                    </select>
                                </label>
                                <label>Fecha de Nacimiento
                                    <input type="date" id="animalBirth" required>
                                </label>
                                <label>Peso Inicial (kg)
                                    <input type="number" id="animalWeight" placeholder="Ej: 250" step="0.1" required>
                                </label>
                                <label>Notas
                                    <input type="text" id="animalNotes" placeholder="Informaci√≥n adicional">
                                </label>
                                <div class="profile-actions">
                                    <button type="submit" class="primary">Guardar Animal</button>
                                    <button type="button" class="ghost" id="cancelAnimalForm">Cancelar</button>
                                </div>
                            </form>
                        </div>

                        <div class="card">
                            <div class="card-head">
                                <h3>Filtros</h3>
                            </div>
                            <div class="farm-form" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                                <label>Buscar
                                    <input type="text" id="searchAnimal" placeholder="ID, nombre...">
                                </label>
                                <label>Finca
                                    <select id="filterFarm">
                                        <option value="">Todas las fincas</option>
                                    </select>
                                </label>
                                <label>Raza
                                    <select id="filterBreed">
                                        <option value="">Todas las razas</option>
                                    </select>
                                </label>
                                <label>Sexo
                                    <select id="filterSex">
                                        <option value="">Todos</option>
                                        <option value="Hembra">Hembra</option>
                                        <option value="Macho">Macho</option>
                                    </select>
                                </label>
                            </div>
                        </div>

                        <div class="farm-list">
                            <h3>Listado de Animales (<span id="animalCount">0</span>)</h3>
                            <div id="animalsList" class="farms">
                                <p class="status">No hay animales registrados</p>
                            </div>
                        </div>
                    </div>

                    <!-- EVENTS SECTION -->
                    <div id="events" class="section hidden">
                        <div class="content-head">
                            <div>
                                <p class="eyebrow">GESTI√ìN DE EVENTOS</p>
                                <h2>Registro de Eventos</h2>
                                <p class="lede">Vacunaciones, tratamientos y m√°s</p>
                            </div>
                            <button class="primary" id="toggleEventForm">‚ûï Nuevo Evento</button>
                        </div>

                        <div class="card farm-card hidden" id="eventFormCard">
                            <h3>Registrar Nuevo Evento</h3>
                            <form id="eventForm" class="farm-form">
                                <label>Tipo de Evento
                                    <select id="eventType" required>
                                        <option value="">Selecciona tipo</option>
                                        <option value="Vacunaci√≥n">üíâ Vacunaci√≥n</option>
                                        <option value="Tratamiento">üíä Tratamiento</option>
                                        <option value="Parto">üêÆ Parto</option>
                                        <option value="Destete">üçº Destete</option>
                                        <option value="Pesaje">‚öñÔ∏è Pesaje</option>
                                        <option value="Otro">üìù Otro</option>
                                    </select>
                                </label>
                                <label>Animal
                                    <select id="eventAnimal" required>
                                        <option value="">Selecciona animal</option>
                                    </select>
                                </label>
                                <label>Fecha
                                    <input type="date" id="eventDate" required>
                                </label>
                                <label>Descripci√≥n
                                    <input type="text" id="eventDesc" placeholder="Detalles del evento" required>
                                </label>
                                <label>Costo (‚Ç¨, opcional)
                                    <input type="number" id="eventCost" placeholder="0.00" step="0.01">
                                </label>
                                <label>Pr√≥xima Fecha (opcional)
                                    <input type="date" id="eventNext" placeholder="Para seguimiento">
                                </label>
                                <div class="profile-actions">
                                    <button type="submit" class="primary">Guardar Evento</button>
                                    <button type="button" class="ghost" id="cancelEventForm">Cancelar</button>
                                </div>
                            </form>
                        </div>

                        <div class="card">
                            <div class="card-head">
                                <h3>Filtros</h3>
                            </div>
                            <div class="farm-form" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                                <label>Tipo
                                    <select id="filterEventType">
                                        <option value="">Todos los tipos</option>
                                        <option value="Vacunaci√≥n">Vacunaci√≥n</option>
                                        <option value="Tratamiento">Tratamiento</option>
                                        <option value="Parto">Parto</option>
                                        <option value="Destete">Destete</option>
                                        <option value="Pesaje">Pesaje</option>
                                        <option value="Otro">Otro</option>
                                    </select>
                                </label>
                                <label>Animal
                                    <select id="filterEventAnimal">
                                        <option value="">Todos los animales</option>
                                    </select>
                                </label>
                            </div>
                        </div>

                        <div class="farm-list">
                            <h3>Historial de Eventos (<span id="eventCount">0</span>)</h3>
                            <div id="eventsList" class="farms">
                                <p class="status">No hay eventos registrados</p>
                            </div>
                        </div>
                    </div>

                    <!-- FCR CALCULATOR SECTION -->
                    <div id="fcr" class="section hidden">
                        <div class="content-head">
                            <div>
                                <p class="eyebrow">CALCULADORA</p>
                                <h2>√çndice de Conversi√≥n Alimenticia (FCR)</h2>
                                <p class="lede">Calcula la eficiencia de conversi√≥n de alimento</p>
                            </div>
                        </div>

                        <div class="panel-grid">
                            <div class="card">
                                <h3>Calcular FCR</h3>
                                <form id="fcrForm" class="farm-form">
                                    <label>Animal (opcional)
                                        <select id="fcrAnimal">
                                            <option value="">C√°lculo general</option>
                                        </select>
                                    </label>
                                    <label>Peso Inicial (kg)
                                        <input type="number" id="fcrWeightInit" placeholder="Ej: 200" step="0.1"
                                            required>
                                    </label>
                                    <label>Peso Final (kg)
                                        <input type="number" id="fcrWeightFinal" placeholder="Ej: 450" step="0.1"
                                            required>
                                    </label>
                                    <label>Alimento Consumido (kg)
                                        <input type="number" id="fcrFeed" placeholder="Ej: 1500" step="0.1" required>
                                    </label>
                                    <label>D√≠as de Engorde
                                        <input type="number" id="fcrDays" placeholder="Ej: 180" required>
                                    </label>
                                    <button type="submit" class="primary full">Calcular</button>
                                </form>
                            </div>

                            <div class="card" id="fcrResults" style="display: none;">
                                <h3>Resultados</h3>
                                <div class="kpi-row" style="grid-template-columns: 1fr;">
                                    <div class="kpi card-soft">
                                        <p class="kpi-label">FCR (Feed Conversion Ratio)</p>
                                        <p class="kpi-value" id="result-fcr">-</p>
                                        <p class="kpi-foot">kg alimento / kg ganancia</p>
                                    </div>
                                    <div class="kpi card-soft">
                                        <p class="kpi-label">Ganancia Total</p>
                                        <p class="kpi-value" id="result-gain">-</p>
                                        <p class="kpi-foot">kg</p>
                                    </div>
                                    <div class="kpi card-soft">
                                        <p class="kpi-label">Ganancia Diaria Promedio</p>
                                        <p class="kpi-value" id="result-adg">-</p>
                                        <p class="kpi-foot">kg/d√≠a</p>
                                    </div>
                                    <div class="kpi card-soft">
                                        <p class="kpi-label">Eficiencia</p>
                                        <p class="kpi-value" id="result-efficiency">-</p>
                                        <p class="kpi-foot" id="result-rating">-</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="farm-list">
                            <h3>Historial de C√°lculos (<span id="fcrHistoryCount">0</span>)</h3>
                            <div id="fcrHistory" class="farms">
                                <p class="status">No hay c√°lculos guardados</p>
                            </div>
                        </div>
                    </div>

                    <!-- FARMS SECTION -->
                    <div id="farms" class="section hidden">
                        <div class="content-head">
                            <div>
                                <p class="eyebrow">GESTI√ìN DE FINCAS</p>
                                <h2>Mis Fincas</h2>
                                <p class="lede">Administra tus explotaciones ganaderas</p>
                            </div>
                        </div>

                        <div class="card farm-card">
                            <h3 id="farmFormTitle">Registrar Nueva Finca</h3>
                            <form id="farmForm" class="farm-form">
                                <input type="hidden" id="farmEditId">
